<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>지도</title>
    <script src="assets/js/jquery-1.9.1.js"></script>
    <script type="text/javascript" src="assets/js/examples-base.js"></script>
    <script type="text/javascript" src="assets/js/highlight.min.js"></script>
    <script type="text/javascript"
            src="https://openapi.map.naver.com/openapi/v3/maps.js?clientId=RyaikNMKgfrzfrriny1D&amp;submodules=drawing"></script>
    <link rel="stylesheet" type="text/css" href="css/examples-base.css"/>
</head>
<body>
<div class="section" id="wrap">
    <h2>CHL Map</h2>
    <div id="map" style="width: 100%; height: 600px"></div>
    year
    <button id="yearAdd">+</button>
    <button id="yearMin">-</button>
    month
    <button id="monthAdd">+</button>
    <button id="monthMin">-</button>
    day
    <button id="add">+</button>
    <button id="min">-</button>
    time
    <button id="timeAdd">+</button>
    <button id="timeMin">-</button>
    <p id="year"></p>
    <p id="month"></p>
    <p id="date"></p>
    <p id="time"></p>
</div>

<script>
    if (!String.prototype.endsWith) {
        String.prototype.endsWith = function (searchString, position) {
            var subjectString = this.toString();
            if (typeof position !== 'number' || !isFinite(position) || Math.floor(position) !== position || position > subjectString.length) {
                position = subjectString.length;
            }
            position -= searchString.length;
            var lastIndex = subjectString.indexOf(searchString, position);
            return lastIndex !== -1 && lastIndex === position;
        };
    }

    var state = {
        year: 2017,
        month: 7,
        day: 9,
        time: 0,
        markerPosition: {
            x: 62,
            y: 66.875
        },
        centerCoord: new naver.maps.Point(75, 60),
        zoom: 3,
        type: 'RGB'
    };

    var tileSize = new naver.maps.Size(200, 200),
        proj = {
            fromCoordToPoint: function (coord) {
                var pcoord = coord.clone();
                if (coord instanceof naver.maps.LatLng) {
                    pcoord = new naver.maps.Point(coord.lng(), coord.lat());
                }
                return pcoord.div(tileSize.width, tileSize.height);
            },
            fromPointToCoord: function (point) {
                return point.clone().mul(tileSize.width, tileSize.height);
            }
        },
        getMapType = function (type) {
            var commonOptions = {
                    name: '',
                    minZoom: 0,
                    maxZoom: 6,
                    tileSize: tileSize,
                    projection: proj,
                    repeatX: false,
                    tileSet: '',
                    vendor: 'KOSC',
                    uid: ''
                },
                mapTypeOptions = $.extend({}, commonOptions, {
                    name: type,
                    tileSet: 'http://222.236.46.44/test/{year}/{month}/{day}/{time}/{type}/{z}/{x}-{y}.JPG'.replace('{type}', type.toLowerCase()).replace('{year}', state.year).replace('{month}', state.month).replace('{day}', state.day).replace('{time}', state.time),
                    uid: ''
                });

            return new naver.maps.ImageMapType(mapTypeOptions);
        };


    var map = new naver.maps.Map('map', {
        center: state.centerCoord,
        zoom: state.zoom,
        minZoom: 3,
        background: '#000000',
        logoControl: false,
        mapTypes: new naver.maps.MapTypeRegistry({
            'RGB': getMapType('RGB'),
            'CDOM': getMapType('CDOM'),
            'TSS': getMapType('TSS'),
            'CHL': getMapType('CHL')
        }),
        mapTypeId: state.type,
        mapTypeControl: true,
        mapTypeControlOptions: {
            position: naver.maps.Position.TOP_RIGHT,
            style: naver.maps.MapTypeControlStyle.DROPDOWN
        },
        disableDoubleClickZoom: true,
        disableDoubleTapZoom: true
    });

    var drawingManager = new naver.maps.drawing.DrawingManager({
        map: map,
        drawingControl: [naver.maps.drawing.DrawingMode.RECTANGLE],
        drawingControlOptions: {
            position: naver.maps.Position.TOP_LEFT,
            style: naver.maps.drawing.DrawingStyle.HORIZONTAL
        },
        controlPointOptions: {
            anchorPointOptions: {
                radius: 5,
                fillColor: '#ff0000',
                strokeColor: '#ff0000',
                strokeWeight: 1
            },
            midPointOptions: {
                radius: 4,
                fillColor: '#ff0000',
                strokeColor: '#ffffff',
                strokeWeight: 2,
                fillOpacity: 0.3
            }
        },
        rectangleOptions: {
            fillColor: '#ff0000',
            fillOpacity: 0.3,
            strokeWeight: 3,
            strokeColor: '#ff0000'
        }
    });

    var marker = new naver.maps.Marker({
        icon: {
            url: 'http://222.236.46.44/assets/img/marker.png',
            size: new naver.maps.Size(25, 34),
            scaleSize: new naver.maps.Size(25, 34),
            origin: new naver.maps.Point(0, 0),
            anchor: new naver.maps.Point(12, 34)
        },
        position: new naver.maps.Point(state.markerPosition.x, state.markerPosition.y),
        map: map
    });

    var $cropBtn = $("li[_dm='1']");
    var cropToggle = false;

    $cropBtn.click(function (e) {
        cropToggle = !cropToggle;
    });

    //    naver.maps.Event.addListener(map, 'click', function (e) {
    //        if (cropToggle)
    //            return;
    //
    //        var nStart = new Date().getTime();
    //        marker.setPosition(e.point);
    //
    //        var fName = e.originalEvent.target.src;
    //
    //    });

    $(document).ready(function () {
        var setState = function (year, month, day, time) {
            state.year = year;
            state.month = month;
            state.day = day;
            state.time = time;
            state.zoom = map.getZoom();
            state.centerCoord = map.getCenter();
            state.type = map.getMapTypeId();
        };


        $("#year").html(state.year + "년");
        $("#month").html(state.month + "월");
        $("#date").html(state.day + "일");
        $("#time").html(state.time + "시");

        $("#yearAdd").click(function () {
            setState(state.year, state.month, state.day, state.time);
            state.year = state.year + 1;
            $("#year").html(state.year + "년");
            map.setOptions('center', state.centerCoord);
            map.setOptions('zoom', state.zoom);
            map.setOptions('mapTypeId', state.type);
            map.setOptions('mapTypes', new naver.maps.MapTypeRegistry({
                'RGB': getMapType('RGB'),
                'CDOM': getMapType('CDOM'),
                'TSS': getMapType('TSS'),
                'CHL': getMapType('CHL')
            }));
        });
        $("#yearMin").click(function () {
            setState(state.year, state.month, state.day, state.time);
            state.year = state.year - 1;
            $("#year").html(state.year + "년");
            map.setOptions('center', state.centerCoord);
            map.setOptions('zoom', state.zoom);
            map.setOptions('mapTypeId', state.type);
            map.setOptions('mapTypes', new naver.maps.MapTypeRegistry({
                'RGB': getMapType('RGB'),
                'CDOM': getMapType('CDOM'),
                'TSS': getMapType('TSS'),
                'CHL': getMapType('CHL')
            }));
        });

        $("#monthAdd").click(function () {
            setState(state.year, state.month, state.day, state.time);
            state.month = state.month + 1;
            $("#month").html(state.month + "월");
            map.setOptions('center', state.centerCoord);
            map.setOptions('zoom', state.zoom);
            map.setOptions('mapTypeId', state.type);
            map.setOptions('mapTypes', new naver.maps.MapTypeRegistry({
                'RGB': getMapType('RGB'),
                'CDOM': getMapType('CDOM'),
                'TSS': getMapType('TSS'),
                'CHL': getMapType('CHL')
            }));
        });
        $("#monthMin").click(function () {
            setState(state.year, state.month, state.day, state.time);
            state.month = state.month - 1;
            $("#month").html(state.month + "월");
            map.setOptions('center', state.centerCoord);
            map.setOptions('zoom', state.zoom);
            map.setOptions('mapTypeId', state.type);
            map.setOptions('mapTypes', new naver.maps.MapTypeRegistry({
                'RGB': getMapType('RGB'),
                'CDOM': getMapType('CDOM'),
                'TSS': getMapType('TSS'),
                'CHL': getMapType('CHL')
            }));
        });


        $("#add").click(function () {
            setState(state.year, state.month, state.day, state.time);
            state.day = state.day + 1;
            $("#date").html(state.day + "일");
            map.setOptions('center', state.centerCoord);
            map.setOptions('zoom', state.zoom);
            map.setOptions('mapTypeId', state.type);
            map.setOptions('mapTypes', new naver.maps.MapTypeRegistry({
                'RGB': getMapType('RGB'),
                'CDOM': getMapType('CDOM'),
                'TSS': getMapType('TSS'),
                'CHL': getMapType('CHL')
            }));
        });

        $("#min").click(function () {
            setState(state.year, state.month, state.day, state.time);
            state.day = state.day - 1;
            $("#date").html(state.day + "일");
            map.setOptions('center', state.centerCoord);
            map.setOptions('zoom', state.zoom);
            map.setOptions('mapTypeId', state.type);
            map.setOptions('mapTypes', new naver.maps.MapTypeRegistry({
                'RGB': getMapType('RGB'),
                'CDOM': getMapType('CDOM'),
                'TSS': getMapType('TSS'),
                'CHL': getMapType('CHL')
            }));
        });

        $("#timeAdd").click(function () {
            setState(state.year, state.month, state.day, state.time);
            state.time = state.time + 1;
            $("#time").html(state.time + "시");
            map.setOptions('center', state.centerCoord);
            map.setOptions('zoom', state.zoom);
            map.setOptions('mapTypeId', state.type);
            map.setOptions('mapTypes', new naver.maps.MapTypeRegistry({
                'RGB': getMapType('RGB'),
                'CDOM': getMapType('CDOM'),
                'TSS': getMapType('TSS'),
                'CHL': getMapType('CHL')
            }));
        });
        $("#timeMin").click(function () {
            setState(state.year, state.month, state.day, state.time);
            state.time = state.time - 1;
            $("#time").html(state.time + "시");
            map.setOptions('center', state.centerCoord);
            map.setOptions('zoom', state.zoom);
            map.setOptions('mapTypeId', state.type);
            map.setOptions('mapTypes', new naver.maps.MapTypeRegistry({
                'RGB': getMapType('RGB'),
                'CDOM': getMapType('CDOM'),
                'TSS': getMapType('TSS'),
                'CHL': getMapType('CHL')
            }));
        });
    });
</script>
</body>
</html>
